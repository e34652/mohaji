<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.team1.mohaji.mapper.main.RegCourseMapper">

    <!-- resultMap -->
    <resultMap id="subject" type="com.team1.mohaji.dto.SubjectDto">
        <id property="subId" column="sub_id" />
        <result property="deptName" column="dept_name" />
        <result property="subName" column="sub_name" />
        <result property="name" column="name" />
        <result property="subType" column="sub_type" />
        <result property="subDesc" column="sub_desc" />
        <result property="subScount" column="sub_scount" />
        <result property="subCredit" column="sub_credit" />
        <result property="subRsdate" column="sub_rsdate" />
        <result property="subRedate" column="sub_redate" />
        <result property="subSdate" column="sub_sdate" />
        <result property="subEdate" column="sub_edate" />
    </resultMap>


    <select id="selectAllSubject" resultMap="subject">
    <![CDATA[
        SELECT
            s.*,
            d.dept_name,
            m.name
        FROM
            subject s
                JOIN
            department d ON s.dept_id = d.dept_id
                JOIN
            professors p ON s.member_id = p.member_id
                JOIN
            members m ON p.member_id = m.member_id;
        ]]>
</select>

    <select id="selectAllSearch" parameterType="String" resultMap="subject">
  <![CDATA[
        SELECT
            s.*,
            d.dept_name,
            m.name
        FROM
            subject s
                JOIN
            department d ON s.dept_id = d.dept_id
                JOIN
            professors p ON s.member_id = p.member_id
                JOIN
            members m ON p.member_id = m.member_id
        WHERE
            s.sub_type = #{category}
          AND s.sub_name LIKE CONCAT('%', #{keyword}, '%');
        ]]>
</select>

    <select id="selectKeyword" parameterType="String" resultMap="subject">
    <![CDATA[
        SELECT
            s.*,
            d.dept_name,
            m.name
        FROM
            subject s
                JOIN
            department d ON s.dept_id = d.dept_id
                JOIN
            professors p ON s.member_id = p.member_id
                JOIN
            members m ON p.member_id = m.member_id
        WHERE
            s.sub_name LIKE CONCAT('%', #{keyword}, '%');
        ]]>
</select>

    <select id="selectCategory" parameterType="String" resultMap="subject">
    <![CDATA[
        SELECT
            s.*,
            d.dept_name,
            m.name
        FROM
            subject s
                JOIN
            department d ON s.dept_id = d.dept_id
                JOIN
            professors p ON s.member_id = p.member_id
                JOIN
            members m ON p.member_id = m.member_id
        WHERE
            s.sub_type = #{category}
        ]]>
</select>


    <select id="selectCountSubject" resultType= "int">
    <![CDATA[
        SELECT COUNT(*)
        FROM subject
        ]]>
</select>

</mapper>