<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>PC 등록 페이지</title>
    <!-- 부트스트랩 CDN 추가 -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <style>
        .pc-count {
            margin-top: 20px;
        }
    </style>
</head>
<body>
<div class="container">
    <h1>PC 등록 페이지</h1>
    <button class="btn btn-primary" onclick="registerPC()">PC 등록</button>
    <div class="pc-count">
        <p>현재 등록된 PC 수: <span id="pcCount">0</span>/3 (최대)</p>
        <p>등록된 PC 주소:</p>
        <ul id="pcList"></ul>
    </div>
</div>

<!-- PC 등록 확인 모달 -->
<div class="modal fade" id="confirmModal" tabindex="-1" role="dialog" aria-labelledby="confirmModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="confirmModalLabel">PC 등록 확인</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                현재 PC를 등록하시겠습니까?
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-dismiss="modal">취소</button>
                <button type="button" class="btn btn-primary" onclick="confirmRegistration()">확인</button>
            </div>
        </div>
    </div>
</div>

<script th:inline="javascript">
    /*[[${ipAddress}]]*/ // 타임리프를 사용하여 모델 값(ipAddress)을 스크립트로 전달받습니다.

    function registerPC() {
        // 모델에서 받은 IP 주소를 사용하여 PC 등록 요청을 서버로 보냅니다.
        var ipAddress = [[${ipAddress}]];
        var pcList = document.getElementById('pcList');
        var pcCount = document.getElementById('pcCount');

        // 등록된 PC 수가 최대 3대 이하인 경우에만 등록 가능
        if (parseInt(pcCount.textContent) < 3) {
            var listItem = document.createElement('li');
            listItem.textContent = ipAddress;

            // 삭제 버튼 생성 및 이벤트 처리 추가
            var deleteButton = document.createElement('button');
            deleteButton.textContent = '삭제';
            deleteButton.className = 'delete-btn btn btn-danger btn-sm';
            deleteButton.onclick = function() {
                pcList.removeChild(listItem);
                pcCount.textContent = parseInt(pcCount.textContent) - 1;
            };

            listItem.appendChild(deleteButton);
            pcList.appendChild(listItem);
            pcCount.textContent = parseInt(pcCount.textContent) + 1;
        } else {
            alert('최대 등록 가능한 PC 수를 초과하였습니다.');
        }


        // fetch('/registerPC?ip=' + ipAddress) // IP 주소를 쿼리 문자열로 전달합니다.
        //     .then(response => response.json())
        //     .then(data => {
        //         if (data.success) {
        //             // 성공적으로 등록된 경우 PC 목록을 업데이트합니다.
        //             var pcList = document.getElementById('pcList');
        //             var pcCount = document.getElementById('pcCount');
        //
        //             // 등록된 PC 수가 최대 3대 이하인 경우에만 등록 가능
        //             if (parseInt(pcCount.textContent) < 3) {
        //                 var listItem = document.createElement('li');
        //                 listItem.textContent = ipAddress;
        //                 pcList.appendChild(listItem);
        //                 pcCount.textContent = parseInt(pcCount.textContent) + 1;
        //             } else {
        //                 alert('최대 등록 가능한 PC 수를 초과하였습니다.');
        //             }
        //         } else {
        //             // 등록에 실패한 경우 처리
        //             alert('PC 등록에 실패하였습니다.');
        //         }
        //     })
        //     .catch(error => {
        //         console.error('PC 등록 중 오류 발생:', error);
        //         alert('PC 등록 중 오류가 발생하였습니다.');
        //     });
    }
</script>

<!-- jQuery 및 부트스트랩 스크립트 -->
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>